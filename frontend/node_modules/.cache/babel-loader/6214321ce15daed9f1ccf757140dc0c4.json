{"ast":null,"code":"import * as React from 'react';\nimport { useGridSelector, useGridApiEventHandler, useGridApiOptionHandler, gridVisibleColumnDefinitionsSelector, gridRowsMetaSelector, GridFeatureModeConstant } from '@mui/x-data-grid';\nimport { useGridVisibleRows } from '@mui/x-data-grid/internals';\n/**\n * @requires useGridColumns (state)\n * @requires useGridDimensions (method) - can be after\n * @requires useGridScroll (method\n */\n\nexport const useGridInfiniteLoader = (apiRef, props) => {\n  const visibleColumns = useGridSelector(apiRef, gridVisibleColumnDefinitionsSelector);\n  const currentPage = useGridVisibleRows(apiRef, props);\n  const rowsMeta = useGridSelector(apiRef, gridRowsMetaSelector);\n  const contentHeight = Math.max(rowsMeta.currentPageTotalHeight, 1);\n  const isInScrollBottomArea = React.useRef(false);\n  const handleRowsScrollEnd = React.useCallback(scrollPosition => {\n    const dimensions = apiRef.current.getRootDimensions(); // Prevent the infite loading working in combination with lazy loading\n\n    if (!dimensions || props.rowsLoadingMode !== GridFeatureModeConstant.client) {\n      return;\n    }\n\n    const scrollPositionBottom = scrollPosition.top + dimensions.viewportOuterSize.height;\n    const viewportPageSize = apiRef.current.unstable_getViewportPageSize();\n\n    if (scrollPositionBottom < contentHeight - props.scrollEndThreshold) {\n      isInScrollBottomArea.current = false;\n    }\n\n    if (scrollPositionBottom >= contentHeight - props.scrollEndThreshold && !isInScrollBottomArea.current) {\n      const rowScrollEndParam = {\n        visibleColumns,\n        viewportPageSize,\n        virtualRowsCount: currentPage.rows.length\n      };\n      apiRef.current.publishEvent('rowsScrollEnd', rowScrollEndParam);\n      isInScrollBottomArea.current = true;\n    }\n  }, [contentHeight, props.scrollEndThreshold, props.rowsLoadingMode, visibleColumns, apiRef, currentPage.rows.length]);\n  const handleGridScroll = React.useCallback(_ref => {\n    let {\n      left,\n      top\n    } = _ref;\n    handleRowsScrollEnd({\n      left,\n      top\n    });\n  }, [handleRowsScrollEnd]);\n  useGridApiEventHandler(apiRef, 'rowsScroll', handleGridScroll);\n  useGridApiOptionHandler(apiRef, 'rowsScrollEnd', props.onRowsScrollEnd);\n};","map":null,"metadata":{},"sourceType":"module"}